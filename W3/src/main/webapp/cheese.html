<!DOCTYPE html>

<html>
    <head>
        <title>Cheese</title>
        <meta charset="UTF-8" />
        <link type="text/css" href="css/styles.css" rel="stylesheet" />
    </head>

    <body>
        <style>
            table, th, td {
                border: 1px solid black;
                border-collapse: collapse;
                padding: 5px;
                text-align: left;

            </style>
            <h1>Cheese</h1>
            <ul>
                <li><a href="/W3/">Home</a></li>
                <li><a href="/W3/client.html">Client Information</a></li>
                <li><a href="/W3/cheese.html">Cheeses</a></li>
                <li><a href="/W3/address.html">Your Addresses</a></li>
                <li><a href="/W3/account.html">Account Information</a></li>
                <li><a href="/W3/orders.html">Orders</a></li>
                <li><a href="/W3/rest/adminmain">Admin</a></li>
                <li style="background:navy;"><a href="/account/add">Add Account</a></li>
                <li style="background:darkgoldenrod;"><a href="/security/login">Login</a></li>
                <li style="background:darkred;"><a>Logout</a></li>
            </ul>

            <br>

            <form onsubmit="create()" id="form"> 
                Add new Cheese: <br> 
                Name:
                <input type="text" name="name" required="required" id="name">
                Price:
                <input type="number" name="price" placeholder="0.00" min="0" value="0" step="0.01" id="price">
                Stock:
                <input type="number" name="stock" required="required" id="stock">
                <input type="submit" value="Add">
            </form>

            <p id="demo"></p>

            <form onsubmit="editor()" id="form2" style="display:none"> 
                    Edit Cheese: <br> 
                    <input type="hidden" name="id" id="editid">
                    Name:
                    <input type="text" name="name" required="required" id="editname">
                    Price:
                    <input type="number" name="price" placeholder="0.00" min="0" value="0" step="0.01" id="editprice">
                    Stock:
                    <input type="number" name="stock" required="required" id="editstock">

                    <input type="submit" value="Edit">
                </form>

                <br>

                <table style="width:80%">
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Stock</th>
                        <!-- <th>View</th>
                        <th>Edit</th>
                        <th>Delete</th>-->
                    </tr>
                    <tbody id="cheeses">
                    </tbody>
                </table>

                <script>
                    fetch('http://localhost:8080/W3/rest/cheese')
                            .then(function (response) {
                                return response.json();
                            }
                            ).then(function (jsonData) {
                        this.el = document.getElementById('cheeses');
                        var data = " ";
                        for (i = 0; i < jsonData.length; i++) {
                            data += '<tr>';
                            data += '<td>' + jsonData[i].cheeseID + '</td>' + '<td>' + jsonData[i].name + '</td>' + '<td>' + jsonData[i].price + '</td>' + '<td>' + jsonData[i].stock + '</td>';
                            data += '<td><button onclick="view(' + jsonData[i].cheeseID + ')">View</button></td>';
                            data += '<td><button onclick="edit(' + jsonData[i].cheeseID + ')">Edit</button></td>';
                            data += '<td><button onclick="remove(' + jsonData[i].cheeseID + ')">Delete</button></td>';
                            data += '</tr>';
                        }
                        return this.el.innerHTML = data;
                    });

                    function create() {
                        var a = document.getElementById("name").value;
                        var b = document.getElementById("price").value;
                        var c = document.getElementById("stock").value;
                        var cheese = {name: a, price: b, stock: c};

                        fetch('http://localhost:8080/W3/rest/cheese', {
                            method: 'POST',
                            body: JSON.stringify(cheese),
                            headers: {
                                'Accept': 'application/json, text/plain, */*',
                                'Content-Type': 'application/json'
                            },
                        }).then(function () {
                            window.location.replace("http://localhost:8080/W3/cheese.html");
                        });
                    }
                    ;

                    function remove(id) {
                        document.getElementById("form").innerHTML = " ";
                        document.getElementById("demo").innerHTML = "Delete Cheese with id: " + id + "?";

                        var button = document.createElement("button");
                        button.innerHTML = "Delete";
                        document.getElementById("demo").appendChild(button);
                        button.addEventListener("click", function () {
                            fetch('http://localhost:8080/W3/rest/cheese' + '/' + id, {
                                method: 'DELETE'
                            }).then(function () {
                                window.location.replace("http://localhost:8080/W3/cheese.html");
                            });
                        });

                        fetch('http://localhost:8080/W3/rest/cheese' + '/' + id)
                                .then(function (response) {
                                    return response.json();
                                }
                                ).then(function (jsonData) {
                            this.el = document.getElementById('cheeses');
                            var data = " ";

                            data += '<tr>';
                            data += '<td>' + jsonData.cheeseID + '</td>' + '<td>' + jsonData.name + '</td>' + '<td>' + jsonData.price + '</td>' + '<td>' + jsonData.stock + '</td>';
                            data += '</tr>';
                            return this.el.innerHTML = data;
                        });
                    }



                    function edit(id) {
                                                document.getElementById("form").innerHTML = " ";
                        document.getElementById("demo").innerHTML = "What do you want to edit?";
                        document.getElementById('form2').style.display = 'block';


                        fetch('http://localhost:8080/W3/rest/cheese' + '/' + id)
                                .then(function (response) {
                                    return response.json();
                                }
                                ).then(function (jsonData) {
                            this.el = document.getElementById('cheeses');
                            var data = " ";

                            data += '<tr>';
                            data += '<td>' + jsonData.cheeseID + '</td>' + '<td>' + jsonData.name + '</td>' + '<td>' + jsonData.price + '</td>' + '<td>' + jsonData.stock + '</td>';
                            data += '</tr>';
                            return this.el.innerHTML = data, document.getElementById('editname').value = jsonData.name,
                                    document.getElementById('editprice').value = jsonData.price, document.getElementById('editstock').value = jsonData.stock,
                            document.getElementById('editid').value = jsonData.cheeseID;
                        });
                    }
                    ;

                    function editor() {
                        var aa = document.getElementById("editid").value;
                        var bb = document.getElementById("editname").value;
                        var cc = document.getElementById("editprice").value;
                        var dd = document.getElementById("editstock").value;
                        var cheese = {cheeseID: aa, name: bb, price: cc, stock: dd};
                        alert(JSON.stringify(cheese));
                        fetch('http://localhost:8080/W3/rest/cheese', {
                            method: 'PUT',
                            body: JSON.stringify(cheese),
                            headers: {
                                'Accept': 'application/json, text/plain, */*',
                                'Content-Type': 'application/json'
                            },
                        }).then(function () {
                            window.location.replace("http://localhost:8080/W3/cheese.html");
                        });
                    }
                    ;


                    function view(id) {
                        document.getElementById("form").innerHTML = " ";
                        fetch('http://localhost:8080/W3/rest/cheese' + '/' + id)
                                .then(function (response) {
                                    return response.json();
                                }
                                ).then(function (jsonData) {
                            this.el = document.getElementById('cheeses');
                            var data = " ";
                            document.getElementById("demo").innerHTML = "Details Cheese named: " + jsonData.name;

                            data += '<tr>';
                            data += '<td>' + jsonData.cheeseID + '</td>' + '<td>' + jsonData.name + '</td>' + '<td>' + jsonData.price + '</td>' + '<td>' + jsonData.stock + '</td>';
                            data += '</tr>';

                            return this.el.innerHTML = data;
                        });
                    }

                </script>
            </body>

        </html>
